Markup control panel
====================

Viewing the markup control panel
--------------------------------

    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(layer['app'])

Login as manager
    >>> loginAsManager(browser)
    >>> from plone.protect.authenticator import createToken

It is only necessary in the test here to add the token.

    >>> browser.open('http://nohost/plone/@@markup-controlpanel?_authenticator=' + createToken())
    >>> browser.url
    'http://nohost/plone/@@markup-controlpanel...'

We have two controls, one for the default type and a multi selection for
alternative formats:

    >>> browser.getControl(name='form.default_type').value
    ['text/html']
    >>> browser.getControl(name='form.allowed_types').value
    ['text/html', 'text/x-web-textile']

Click the save button without making any changes:

    >>> browser.getControl(name="form.actions.save").click()
    >>> browser.url.endswith('markup-controlpanel')
    True

We should get a status message:

    >>> 'Changes saved.' in browser.contents
    True

Now click the cancel button:

    >>> browser.getControl(name="form.actions.cancel").click()
    >>> browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in browser.contents
    True

Modifying values
----------------

    >>> browser.open('http://nohost/plone/@@markup-controlpanel')
    >>> browser.getControl(name='form.default_type').value = ['text/x-web-textile',]
    >>> browser.getControl(name='form.allowed_types').value = ['text/html', 'text/x-web-textile']
    >>> browser.getControl(name="form.actions.save").click()
    >>> 'Changes saved' in browser.contents
    True

Verify, that the settings have actually been changed:

    >>> portal = layer['portal']
    >>> portal.portal_properties.site_properties.default_contenttype
    'text/x-web-textile'
    >>> forbidden_types = portal.portal_properties.site_properties.forbidden_contenttypes
    >>> set(portal.portal_transforms.listAvailableTextInputs()) - set(forbidden_types)
    set(['text/html', 'text/x-web-textile'])
