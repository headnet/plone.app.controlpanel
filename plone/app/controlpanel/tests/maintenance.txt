Maintenance control panel
=========================

First some initial setup code:

    >>> from plone.testing.z2 import Browser
    >>> browser = Browser(layer['app'])

Login as manager
    >>> loginAsManager(browser)

Viewing the maintenance control panel
-------------------------------------

    >>> browser.open('http://nohost/plone/@@maintenance-controlpanel')
    >>> browser.url.endswith('maintenance-controlpanel')
    True

While we have manage permisssions inside the site, we don't have them at the
Zope root:

    >>> 'You are not allowed to manage the Zope server' in browser.contents
    True

Let's create a manager at the Zope root:

    >>> layer['app'].acl_users.userFolderAddUser('app', 'secret', ['Manager'], [])

And log in as that user instead:

    >>> browser.open('http://nohost/plone/')
    >>> browser.getLink('Log out').click()
    >>> loginAsManager(browser, user='app')

See if we can manage the server now:

    >>> browser.open('http://nohost/plone/@@maintenance-controlpanel')
    >>> browser.url.endswith('maintenance-controlpanel')
    True

    >>> 'Zope Database' in browser.contents
    True

While we cannot test the actual packaging during tests, we can skip the actual
manage_pack method by providing a negative value for days:

    >>> browser.getControl(name='form.days').value = '-1'
    >>> browser.getControl(name="form.actions.pack").click()
    >>> browser.url.endswith('maintenance-controlpanel')
    True

We should get a status message:

    >>> 'Packed the database.' in browser.contents
    True
